kind: pipline
name: Winsper-HeanService

steps:
- name: test
  image: gusabary/cn-maven
#  volumes:
#  - name: dependency
#    path: /root/.m2
# - name: configuration
#   path: /drone/src/back-end/src/main/resources/application.yml
  commands:
  - mvn clean
  - mvn package -Dmaven.test.skip=true
  - echo "test and package hean-service completed ðŸ™‚ðŸ™‚ðŸ™‚"

- name: upload
  image: appleboy/drone-scp
  settings:
    host: localhost
    username: root
    rm: true
    target: /root/Winsper/drone-tmp
    source:
      - target/hean-service-0.0.1-SNAPSHOT.jar
      - Dockerfile

- name: deploy
  image: appleboy/drone-ssh
  settings:
    host: localhost
    username: root
    script:
      - cd /root/Winsper/drone-tmp/target
      - cp ../Dockerfile .
      - docker build -t gusabary/winsper-hean:v1.0.0 .
      - docker login
      - docker push gusabary/winsper-hean
      - kubectl set image deploy/winsper-hean winsper-hean=gusabary/winsper-hean:v1.0.0

#volumes:
#- name: dependency
#  host:
#    path: /root/.m2